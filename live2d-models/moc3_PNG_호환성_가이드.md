# .moc3 파일과 PNG 파일 호환성 이해하기

## 📖 기본 개념 이해하기

### 1. .moc3 파일이란?

**.moc3 파일은 Live2D 모델의 "골격과 변형 정보"를 담고 있는 바이너리 파일입니다.**

**비유로 이해하기:**
- `.moc3` = **인형의 뼈대와 관절**
- PNG 파일 = **인형에 입힐 옷감**

인형의 뼈대(.moc3)는 "여기 눈이 있고, 여기 입이 있고, 여기 팔이 있다"는 정보를 가지고 있습니다.
그리고 "이 부분의 옷감(PNG)은 어디에 붙여야 하는가"라는 **위치 정보(UV 좌표)**도 가지고 있습니다.

### 2. UV 좌표란?

**UV 좌표는 PNG 이미지의 어떤 부분이 모델의 어떤 부위에 매핑되는지를 나타내는 좌표입니다.**

**비유로 이해하기:**
- PNG 이미지 = **큰 천 조각**
- UV 좌표 = **"이 천의 (100, 200) 위치에 있는 그림이 인형의 얼굴에 붙는다"**는 지도

**예시:**
```
PNG 이미지 (1024x1024):
┌─────────────────────────┐
│  [눈]  [코]  [입]      │  ← 이 부분이
│                        │
│  [머리]                │  ← 얼굴에 매핑됨
│                        │
│  [몸통]                │  ← 몸통에 매핑됨
└─────────────────────────┘

.moc3 파일이 말하는 것:
"PNG의 (100, 50) 위치부터 (300, 200)까지 = 얼굴"
"PNG의 (0, 400) 위치부터 (500, 800)까지 = 몸통"
```

### 3. 파츠 배치란?

**파츠 배치는 PNG 이미지 안에서 각 부위(눈, 입, 머리 등)가 어디에 그려져 있는지를 의미합니다.**

**비유로 이해하기:**
- PNG 이미지 = **큰 종이**
- 파츠 배치 = **"눈은 종이의 왼쪽 위에, 입은 중앙에, 머리는 위쪽에 그려져 있다"**

---

## 🔍 호환성 문제가 발생하는 경우

### 문제 상황 1: PNG 파일만 교체한 경우

**시나리오:**
1. 원본 shizuku 모델의 PNG 파일을 백설공주 PNG로 교체
2. `.moc3` 파일은 그대로 사용

**문제:**
- `.moc3` 파일은 원본 PNG의 파츠 위치를 기억하고 있음
- 새로운 PNG의 파츠 위치가 다르면 → **잘못된 부분이 표시됨**

**예시:**
```
원본 PNG (shizuku):
┌─────────────────┐
│ [눈] [코] [입]  │  ← .moc3가 기억하는 위치
└─────────────────┘

새로운 PNG (snow_white):
┌─────────────────┐
│ [입] [코] [눈]  │  ← 위치가 다름!
└─────────────────┘

결과: 눈이 입 위치에, 입이 눈 위치에 표시됨! 😱
```

### 문제 상황 2: PNG 해상도가 다른 경우

**시나리오:**
- 원본: 1024x1024 픽셀
- 새로운 PNG: 2048x2048 픽셀

**문제:**
- UV 좌표가 픽셀 단위로 저장되어 있으면 → **크기 불일치**
- 하지만 Live2D는 보통 정규화된 좌표(0.0~1.0)를 사용하므로 문제 없을 수 있음

### 문제 상황 3: 파츠가 누락된 경우

**시나리오:**
- `.moc3` 파일이 "눈 파츠"를 찾는데
- 새로운 PNG에 눈이 없음

**문제:**
- 해당 파츠가 표시되지 않거나 오류 발생

---

## ✅ 호환성 확인 방법

### 방법 1: 실제로 로드해보기 (가장 확실한 방법)

**1단계: Live2D Viewer 사용**
- Live2D 공식 Viewer 다운로드: https://www.live2d.com/download/
- `snow_white.model3.json` 파일을 Viewer에서 열기
- 모델이 정상적으로 표시되는지 확인

**2단계: 애플리케이션에서 테스트**
- Open-LLM-VTuber 애플리케이션 실행
- snow_white 모델 선택
- 모델이 로드되고 정상 작동하는지 확인

**확인 사항:**
- ✅ 모델이 로드되는가?
- ✅ 얼굴, 눈, 입이 올바른 위치에 있는가?
- ✅ 파라미터 제어가 정상 작동하는가?
- ✅ 애니메이션이 정상 작동하는가?

### 방법 2: 파일 크기 비교 (간접 확인)

**원본과 새 PNG 파일 크기 비교:**
```bash
# shizuku PNG 파일 크기 확인
ls -lh live2d-models/shizuku/runtime/shizuku.1024/*.png

# snow_white PNG 파일 크기 확인
ls -lh live2d-models/snow_white/runtime/snow_white.1024/*.png
```

**의미:**
- 파일 크기가 비슷하면 → 해상도와 복잡도가 비슷할 가능성 높음
- 하지만 이것만으로는 호환성을 확정할 수 없음

### 방법 3: 이미지 해상도 확인

**Python 스크립트로 확인:**
```python
from PIL import Image

# PNG 파일 해상도 확인
for i in range(5):
    img = Image.open(f'snow_white/runtime/snow_white.1024/texture_{i:02d}.png')
    print(f'texture_{i:02d}.png: {img.size}')
```

**확인 사항:**
- 모든 텍스처가 1024x1024인지 확인
- 해상도가 다르면 문제 발생 가능

---

## 🎯 실제 상황 분석: snow_white 모델

### 현재 상황

**snow_white 모델의 경우:**
- ✅ `.moc3` 파일 존재: `snow_white.moc3`
- ✅ PNG 파일 5개 모두 존재
- ✅ 구조 파일들(`model3.json`, `cdi3.json` 등)이 shizuku와 동일

### 가능성 분석

**시나리오 A: 완전히 새로운 모델인 경우**
- `.moc3` 파일이 snow_white PNG와 함께 제작됨
- → **호환성 문제 없음** ✅

**시나리오 B: shizuku의 PNG만 교체한 경우**
- `.moc3` 파일이 shizuku PNG를 기반으로 제작됨
- snow_white PNG의 파츠 배치가 shizuku와 다르면 → **호환성 문제 발생** ⚠️

**시나리오 C: shizuku를 기반으로 재제작한 경우**
- shizuku 모델을 Live2D Cubism Editor에서 열고
- PNG만 교체하고 다시 내보내기
- → **호환성 문제 없음** ✅

---

## 🔧 문제 발생 시 해결 방법

### 문제 1: 모델이 로드되지 않음

**증상:**
- Live2D Viewer에서 모델을 열면 오류 발생
- 애플리케이션에서 모델이 표시되지 않음

**해결 방법:**
1. **파일 경로 확인**
   - `model3.json`에서 참조하는 경로와 실제 파일 경로가 일치하는지 확인
   - 파일 이름 대소문자 확인 (Linux는 대소문자 구분)

2. **PNG 파일 형식 확인**
   ```bash
   file snow_white/runtime/snow_white.1024/*.png
   ```
   - PNG 형식인지 확인
   - 손상된 파일이 있는지 확인

3. **.moc3 파일 확인**
   - `.moc3` 파일이 존재하는지 확인
   - 파일이 손상되지 않았는지 확인

### 문제 2: 모델은 로드되지만 파츠가 잘못 표시됨

**증상:**
- 모델은 로드되지만 눈이 입 위치에, 입이 눈 위치에 표시됨
- 일부 파츠가 누락되거나 잘못된 위치에 표시됨

**원인:**
- PNG 파일의 파츠 배치가 `.moc3` 파일과 일치하지 않음

**해결 방법:**
1. **원본 PNG와 비교**
   - shizuku의 PNG 파일과 snow_white의 PNG 파일 비교
   - 파츠 위치가 동일한지 확인

2. **Live2D Cubism Editor에서 재제작**
   - shizuku 모델을 Cubism Editor에서 열기
   - PNG 파일을 snow_white PNG로 교체
   - 모델을 다시 내보내기 (`.moc3` 파일 재생성)

### 문제 3: 파라미터 제어가 작동하지 않음

**증상:**
- 모델은 표시되지만 눈 깜빡임, 입 움직임 등이 작동하지 않음

**원인:**
- `.moc3` 파일의 파라미터 설정이 PNG와 맞지 않음
- 또는 파라미터 ID가 다름

**해결 방법:**
- `cdi3.json` 파일 확인
- 파라미터 ID가 올바른지 확인
- 필요시 Cubism Editor에서 재설정

---

## 📋 체크리스트

### 기본 확인 사항
- [ ] `.moc3` 파일이 존재하는가?
- [ ] PNG 파일 5개가 모두 존재하는가?
- [ ] `model3.json`에서 참조하는 경로가 올바른가?
- [ ] 모든 파일 이름이 일치하는가?

### 호환성 확인 사항
- [ ] Live2D Viewer에서 모델이 로드되는가?
- [ ] 모델이 정상적으로 표시되는가?
- [ ] 파츠가 올바른 위치에 있는가?
- [ ] 파라미터 제어가 작동하는가?
- [ ] 애니메이션이 정상 작동하는가?

### 문제 발생 시 확인 사항
- [ ] PNG 파일 해상도가 올바른가? (1024x1024)
- [ ] PNG 파일이 손상되지 않았는가?
- [ ] `.moc3` 파일이 손상되지 않았는가?
- [ ] 원본 PNG와 파츠 배치가 동일한가?

---

## 💡 핵심 정리

### .moc3 파일과 PNG 파일의 관계

```
.moc3 파일 = 지도책
  - "이 모델은 눈, 입, 머리가 있다"
  - "PNG 이미지의 (100, 50) 위치에 있는 그림이 눈이다"
  - "PNG 이미지의 (200, 300) 위치에 있는 그림이 입이다"

PNG 파일 = 실제 그림
  - 눈, 입, 머리가 그려진 큰 그림

호환성 = 지도책(.moc3)이 가리키는 위치에 실제로 그 그림이 있는가?
```

### 가장 확실한 확인 방법

**실제로 모델을 로드해보는 것이 가장 확실한 방법입니다!**

1. Live2D Viewer에서 테스트
2. 애플리케이션에서 테스트
3. 문제가 있으면 → Live2D Cubism Editor에서 재제작

### snow_white 모델의 경우

**현재 상태:**
- 구조적으로는 완벽함 ✅
- 실제 호환성은 로드 테스트 필요 ⚠️

**권장 사항:**
1. **먼저 실제로 로드해보기**
   - Live2D Viewer나 애플리케이션에서 테스트
   - 문제가 없으면 그대로 사용

2. **문제가 있으면**
   - Live2D Cubism Editor에서 shizuku 모델 열기
   - PNG 파일을 snow_white PNG로 교체
   - 모델 다시 내보내기

---

## 🎓 추가 학습 자료

- Live2D 공식 문서: https://docs.live2d.com/
- Live2D Cubism Editor: https://www.live2d.com/download/
- UV 매핑 개념: https://en.wikipedia.org/wiki/UV_mapping

